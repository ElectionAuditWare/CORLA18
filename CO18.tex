%\documentclass[12pt]{article}
\documentclass[runningheads]{llncs}

%\bibliographystyle{plainnat}
\bibliographystyle{splncs04}
\usepackage{graphicx}
\usepackage{amssymb,amsmath,color}
\usepackage[breaklinks=true]{hyperref}
\renewcommand\UrlFont{\color{blue}\rmfamily}

\usepackage[anythingbreaks]{breakurl}
%\usepackage[round]{natbib}
%\usepackage{amsthm}
%\usepackage{algorithm}
%\usepackage{algorithmicx}
%\usepackage[noend]{algpseudocode}
\newtheorem{thm}{Theorem}
%\newtheorem{definition}{Definition}

\newcommand{\beq}{\begin{equation}}
\newcommand{\eeq}{\end{equation}}
\newcommand{\ben}{\begin{enumerate}}
\newcommand{\een}{\end{enumerate}}

\newcommand{\mc}[1]{\ensuremath{\mathcal{#1}}}
\newcommand{\mb}[1]{\ensuremath{\mathbb{#1}}}
\newcommand{\ul}[1]{\ensuremath{\underline{#1}}}
\newcommand{\RM}{\emph{RM}}
\newcommand{\A}{\emph{A}}
\newcommand{\B}{\emph{B}}
\newcommand{\C}{\emph{C}}
\newcommand{\EE}{\bb{E}}
\newcommand{\PP}{\bb{P}}
\newcommand{\bpi}{\bar{\pi}}
\newcommand{\bp}{\bar{p}}

\newcommand{\comment}[1]{}
%\newcommand{\note}[1]{\textcolor{red}{\sc #1}}



\title{Next Steps for the Colorado Risk-Limiting Audit (CORLA) Program}

\author{
   Mark Lindeman\inst{1}\orcidID{0000-0001-8815-815X} \and
   Neal McBurnett\inst{2}\orcidID{0000-0001-8667-1830} \and
   Kellie Ottoboni\inst{3}\orcidID{0000-0002-9107-3402} \and
   Philip B.~Stark\inst{3}\orcidID{0000-0002-3771-9604}
}
\authorrunning{M. Lindeman et al.}

\institute{Department of Political Science, Columbia University, NY, USA \and
Neal's affiliation \and
Department of Statistics, University of California, Berkeley, CA, USA}
%\email{lncs@springer.com}\\
%\url{http://www.springer.com/gp/computer-science/lncs} \and
%ABC Institute, Rupert-Karls-University Heidelberg, Heidelberg, Germany\\
%\email{\{abc,lncs\}@uni-heidelberg.de}}


\date{Version: \today}

\begin{document}
\maketitle


\begin{abstract}
Colorado CRS~1-7-515 requires risk-limiting tabulation audits (RLAs) starting in 2017.
Most Colorado counties (comprising 98.2\% of voters) have voting equipment amenable to ballot-level comparison audits, but some
are only able to perform ballot-polling audits. 
How to combine ballot-polling and ballot-level comparison audits to check outcomes of contests that cross jurisdictional lines has not been addressed.
Moreover, Colorado's current audit software (RLATool) does not support audits of cross-jurisdictional contests, even contests entirely
contained in counties that can conduct ballot-level comparison audits. 
This paper addresses both gaps, along the way introducing a simple, efficient way to use 
stratified sampling in RLAs.
(Stratification makes it easier to combine ballot-polling and ballot-level comparisons, and also is useful to reduce the
required level of coordination among jurisdictions to audit cross-jurisdictional contests.)
We present simple but inefficient methods, more efficient methods
that combine ballot polling and ballot-level comparisons using stratified samples,
and methods that combine ballot-level comparison and
variable-size batch comparison audits without stratification,
noting the changes to RLATool that each of these methods would require.
We provide open-source reference implementations of the preferred methods in Jupyter notebooks.
\keywords{\textbf{\textcolor{red}{Anything to add?}} elections, auditing, stratified sampling, Fisher's combining function, sequential hypothesis tests}
\end{abstract}

\noindent
\textbf{Acknowledgements.}
We are grateful to Ronald L.~Rivest and Steven N.~Evans for helpful conversations and suggestions.

\section{Introduction}
A risk-limiting audit (RLA) of an election is a procedure that
has a known, pre-specified minimum chance of correcting the electoral outcome if the outcome
is incorrect---that is, if the reported outcome differs from the outcome that a full manual
tabulation of the votes would find. 
RLAs require a durable, voter-verifiable record of voter intent, such as paper ballots,
and they assume that this audit trail is sufficiently complete and accurate that a full hand
tally would show the true electoral outcome.
That assumption is not automatically satisfied: a \emph{compliance audit}
\cite{starkWagner12} 
is required.

Risk-limiting audits are generally (but not necessarily) incremental: they examine more ballots, or batches of ballots,
until either (i)~there is strong statistical evidence that a full hand tabulation would confirm the outcome,
or (ii)~the audit has led to a full hand tabulation, the result of which should become the official
result.

RLAs have been piloted in California, Colorado, and Ohio, and a test of
RLA procedures has been conducted in Arizona.
RLA bills are being drafted or are already under consideration in California,
Virginia, Washington, and other states.
A number of laws have either allowed or mandated risk-limiting audits,
including California AB~2023 (Salda\~{n}a), SB~360 (Padilla), and AB~44 (Mullin);
Rhode Island SB~413A and HB~5704A; and Colorado Revised Statutes (CRS)~1-7-515.
At the time of writing, California is considering another RLA bill, AB~2125.

CRS~1-7-515 requires 
Colorado to conduct risk-limiting audits beginning in 2017.
(There are provisions to allow the Secretary of State to exempt some counties.)
The first set of coordinated risk-limiting election audits across the state took place in Colorado in November, 2017.\footnote{%
 See \url{https://www.sos.state.co.us/pubs/elections/RLA/2017RLABackground.html}
}
Those audits only covered contests restricted to a single county,
so counties could conduct audits independently.
To audit statewide elections and contests that cross county lines, Colorado will need to implement new approaches
and modify RLATool\footnote{%
  \url{https://github.com/FreeAndFair/ColoradoRLA/}
}, 
the open-source audit software used for their 2017 audits. 

Colorado's ``uniform voting system'' program\footnote{%
  \url{https://www.sos.state.co.us/pubs/elections/VotingSystems/UniformVotingSystem.html}
} led
many Colorado counties to purchase (or to plan to purchase) voting systems
that are auditable at the ballot level: those systems export cast vote records (CVRs)
for individual ballots in a manner that allows the corresponding paper ballot to be identified,
and conversely, make it possible to find the CVR corresponding to any
particular paper ballot.
We call counties that have such systems ``CVR'' counties.
It is estimated that by June, 2018, 98.2\% of active Colorado voters will be in CVR counties.
CVR counties can perform ``ballot-level comparison audits,'' \cite{lindemanStark12} 
which are currently the
most efficient approach to risk-limiting audits in that they require examining
fewer ballots than other methods do, when the outcome of the contest under audit 
is in fact correct.

Voting systems in other counties (``legacy'' or ``no-CVR'' counties) 
do not allow auditors to check how the system
interpreted voter intent for individual ballots.
The election results can still be audited, provided the voting systems
create a voter-verifiable paper trail (\emph{e.g.}, voter-marked paper ballots) that is
conserved to ensure that it remains accurate and intact, and organized well enough
to permit ballots to be selected at random.
Pilot audits in California \cite{CA_SOS_EAC} suggest it is more efficient to audit such systems
using``ballot-polling'' \cite{lindemanEtal12,lindemanStark12} than using ``batch-level comparisons.''

There is currently no literature on how to combine
ballot polling and ballot-level comparison to conduct a risk-limiting audit.
Existing methods would either require all counties to use the lowest
common denominator (ballot-polling, which does not take advantage of the CVRs,
and thus is expected to require more auditing than a method that does),
 or would require no-CVR counties to perform batch-level comparisons, which were found in
California to be (generally) less efficient than ballot-polling audits.%
\footnote{%
  See~\cite{Rivest-2018-bayesian-tabulation-audits}
  for a different (Bayesian) approach to auditing contests that include both CVR counties
  and no-CVR counties. In general, Bayesian audits are not risk-limiting.
}
The audit software RLATool needs additional features to be able to audit
contests that cross county lines.

First, the current version (1.1.0) of RLATool
needs to be modified to recognize and group together contests that cross jurisdictional
boundaries; currently, it treats every contest as if it were entirely
contained in a single county.
% Margins and risk limits apply to entire contests, not to the portion of a contest included in a county.
RLATool also does not allow the user to select the sample size, nor does
it directly allow an unstratified random sample to be drawn across counties.

Second, to audit a contest that includes votes in no-CVR counties
and votes in CVR counties, new statistical methods are needed to
preserve the efficiency of ballot-level comparison audits in CVR counties.

%Third, contests that appear only on a subset of ballots can
%be audited much more efficiently if the sample can be drawn from just those ballots
%that contain the contest.
%While allowing samples to be restricted to ballots reported\footnote{%
% There are methods for conducting RLAs that account for the possibility that the reported ballot style is incorrect;
% see~\cite{banuelosStark12}.
%} or known to contain a particular
%contest is not essential in the short run, it will be necessary
%eventually to make it affordable to audit smaller contests.

We focus on near-term requirements for risk-limiting audits in Colorado, incidentally
developing a new, widely applicable method for using stratified samples in RLAs.
Section~\ref{sec:crude} presents crude but inefficient approaches
that could be implemented easily.
Section~\ref{sec:variable}
presents an approach based on comparison audits with different batch sizes.
This approach is statistically simple and relatively efficient, but might require changing how counties
handle their ballots.
Section~\ref{sec:hybrid} presents our recommended approach, which combines ballot-level
comparisons in counties that can perform them with ballot-polling in the no-CVR counties.
% This approach is generalizable to other stratified audits, where ballots are divided into disjoint
% ``strata,'' sampled independently; the results are combined using Fisher's method to produce an audit of the
% overall contest.
All the approaches require new software, including some changes to RLATool.
We provide example software implementing the risk calculations for
our recommended approach as a Python Jupyter notebook.\footnote{%
 See \url{https://github.com/pbstark/CORLA18}.
}
%Section~\ref{sec:subcollections}
%describes how audit efficiency could be improved in CVR counties by combining CVR
%data with data from Colorado's voter registration system, SCORE.\footnote{%
%  SCORE is Colorado's voter registration system, which also tracks who voted.
%  See \url{https://www.sos.state.co.us/pubs/elections/SCORE/SCOREhome.html}.
%  SCORE essentially keeps track of how many ballots of each style were returned by voters,
%  information that can be used to check whether the voting system tabulated the correct number
%  of ballots in each contest.
%} 
Sections~\ref{sec:comparisonError} and~\ref{sec:ballotPollError} explain the recommended
modifications to ballot-level comparison and ballot-polling audits, respectively. 
Section~\ref{sec:recommendations} summarizes our recommendations and
considerations for implementation.

%\subsection{Priorities for Colorado}
%\note{for this particular paper focused on stratification, is the order of paragraphs here right?}
%Auditing efficiency is controlled in part by how well the audit can limit the sample to ballots that
%contain the contests under audit.
%Some contests are on (essentially) every ballot, for instance the governor's race.
%Others, such as mayoral contests, may appear on only a small fraction of ballots cast in
%a county.
%Partisan primaries---even for statewide office---are somewhere in between,
%because in general no single party's primary appears on every ballot cast in the state.
%Thus, either we reduce efficiency for the sake of simplicity by continuing to sample ballots uniformly within 
%counties (or collections of counties), or we develop a way to
%focus the auditing on the ballots that contain the contest.
%The latter requires external information, e.g., from SCORE,
%as discussed below.
%
%Moreover, party primaries for statewide offices (and perhaps other contests) will
%include CVR counties and no-CVR counties, so we need a method to audit
%across both kinds of voting technology. 
%
%This report addresses both issues, providing options for effectively auditing heterogeneous 
%voting technology, varying in efficiency, complexity, and on whom any additional audit burden falls.

\section{Preliminary notation}
Here and generally throughout the paper, we 
discuss auditing a single plurality contest at a time, although the same sample can be used to audit
more than one contest (and super-majority contests), and there are ways of combining audits of different contests into
a single process \cite{stark09c,stark10d}.
We use terminology drawn from a number of papers; the key reference is Lindeman and Stark, 2012~\cite{lindemanStark12}.
An \emph{overstatement error} is an error that caused the margin between \emph{any} reported
winner and \emph{any} reported loser to appear larger than it really was.
An \emph{understatement error} is an error that caused the margin between \emph{every} reported
winner and \emph{every} reported loser to appear to be smaller than it really was.

Throughout, we will refer to a contest between reported winner $w$ and reported loser $\ell$.
The total number of reported votes for candidate~$w$ is denoted $V_w$ 
and the total for candidate~$\ell$ is denoted $V_\ell$, so that $V_w > V_\ell$, since 
$w$ is the reported winner.
Additional notation is introduced below as the need arises.

\section{Simple approaches} \label{sec:crude}

\subsection{Hand count the legacy counties}
The simplest approach to combining legacy counties with CVR counties is to require every
legacy county to do a full hand count, and to conduct a 
ballot-level comparison audit in CVR counties, based on contest margins adjusted for
the results of the manual tallies in the CVR counties.
For instance, imagine a contest with two candidates, reported winner $w$ and reported loser $\ell$.
Suppose that a full manual tally of the votes in the legacy counties shows $V_w'$ votes for $w$ and
$V_\ell'$ votes for $\ell$.
Suppose that a total of $N$ ballots were cast in the CVR counties.
Then the \emph{diluted margin}  for the comparison audit in the CVR counties is defined to be
$[(V_w-V_w')-(V_\ell-V_\ell')]/N$.
Requiring a full hand count in the legacy counties has obvious disadvantages, except perhaps in very 
close contests where ballot polling is not efficient. 
(But it does have the advantage of not forcing CVR 
counties to do additional auditing to compensate for the legacy counties.)

%\subsection{Subtract error bounds for the legacy counties from vote totals}
%If ballot accounting and data from Colorado's voter registration system, SCORE,\footnote{%
%  SCORE is Colorado's voter registration system, which also tracks who voted.
%  See \url{https://www.sos.state.co.us/pubs/elections/SCORE/SCOREhome.html}.
%  SCORE essentially keeps track of how many ballots of each style were returned by voters,
%  information that can be used to check whether the voting system tabulated the correct number
%  of ballots in each contest.
%}
% can provide good upper bounds on the number of ballots cast in
%each contest in legacy counties, there are simple upper bounds on the total
%possible overstatement error each legacy county could contribute to the overall contest
%results; those can be subtracted from the overall margin (as in the previous subsection) and the
%remainder of the contests can be audited in CVR counties against the adjusted margins.
%For instance, consider a contest that appears on $N$ ballots in a legacy counties.
%Suppose that in legacy counties, the overall, statewide contest winner, $w$, is reported to have received $V_w'$ votes, and some loser, $\ell$, is reported to have received $V_\ell'$ votes. 
%(Note that $V_\ell'$ could be greater than $V_w'$: $w$ is not necessarily the reported winner in the legacy counties.)
%Then the most overstatement error that the county could possibly have in determining whether
%$w$ in fact beat $\ell$ is if every reported undervote, invalid vote, or vote for a different candidate, $t$, had 
%in fact been a vote for $\ell$ (producing a 1-vote overstatement), and every vote reported for 
%$w$ was in fact a vote for $\ell$ (producing a 2-vote overstatement).
%The reduction in the margin that would produce is 
%$N - V_w' - V_\ell' + 2V_w' = N + V_w' - V_\ell'$ votes.
%
%Whereas the previous approach places the auditing burden created by obsolescent equipment entirely on 
%the legacy counties, this approach places it entirely upon the CVR counties. In a close contest, it 
%could require a full hand count in every county.

\subsection{Treat legacy counties as if every ballot selected from them for audit has a two-vote overstatement}\label{sec:two-vote-over}
Another simple-but-inefficient approach is to sample uniformly from all counties as if one
were performing a ballot-level comparison audit everywhere,  but to 
treat any ballot
selected from a legacy county as a two-vote overstatement. 
This approach has the same disadvantages
as the previous approach.

\section{Variable batch sizes} \label{sec:variable}

Another approach is to perform a comparison audit across all counties, but to use batches consisting
of more than one ballot (batch-level comparisons)
in legacy counties and batches consisting of a single ballot (ballot-level comparisons) in CVR counties.\footnote{%
 For majority and plurality elections, including those in which voters can select more than one candidate,
  audits can be based on overstatement and understatement errors at the level of batches.
}
This requires that the no-CVR counties report vote subtotals
for physically identifiable batches.
If a county's voting system can only report subtotals by precinct but 
the county does not sort paper ballots by
precinct, this approach might require revising how the county handles its
paper; we understand that this is the case in many Colorado counties.

That said, many California counties that do not sort vote-by-mail (VBM)
ballots by precinct conduct the statutory 1\% audits by manually retrieving the ballots 
for just those precincts selected for audit from whatever physical batches they happen to be in: 
the situation is identical to that in Colorado.

Another tactic is the ``Boulder-style'' batch-level audit,\footnote{%
 See \url{http://bcn.boulder.co.us/~neal/elections/boulder-audit-10-11/}.
}
which requires generating 
vote subtotals after each physical batch is scanned, and exporting those subtotals in machine-readable form.
That in turn may require using extra memory cards, repeatedly initializing and deleting tabulation databases,
or other measures that add complexity and opportunity for error.

While those two approaches are laborious, they would provide a viable short-term solution,
especially combined with information from SCORE\footnote{%
 SCORE is Colorado's Statewide Voter Registration System; see
 \url{https://www.sos.state.co.us/pubs/elections/SCORE/SCOREhome.html} (last visited 5 May 2018).
}
to check that the reported batch-level results contain the correct number of ballots for each contest under audit.
Moreover, it does not unduly increase the workload in CVR counties
to compensate for legacy equipment.

Variable-batch-size comparison audits would require modifying or augmenting
RLATool in several ways: 

\begin{enumerate}

  \item The CVR reporting tool would need to be modified to allow no-CVR counties to
report batch-level results in a manner analogous to how CVR counties report
ballot-level results, or an external tool would need to be provided.

  \item The sampling
algorithm would have to allow sampling batches with unequal probability.
Efficient batch-level audits involve sampling batches with probability proportional
to a bound on the possible overstatement error in the batch.
It would also need to calculate the appropriate sampling probability for each batch.
Again, this could be accommodated using an external tool to draw the sample from legacy counties.

  \item The risk calculations would need to be modified. 
This, too, could be done with external software, with suitable provisions for capturing audit data
from RLATool or directly from legacy counties.
\end{enumerate}

None of these changes is enormous; the mathematics and statistics are already worked out
in published papers \textbf{\textcolor{red}{PROVIDE CITES}} that include exemplar code for calculating the
batch-level error bounds, drawing the samples with probability proportional to an
error bound, and calculating the attained risk from the sample results.
Indeed, this is the method that was used in several of California's pilot audits,
including the audit in Orange County.
Section~\ref{sec:comparisonError} derives a method for comparison audits with variable batch sizes.

\section{Stratified ``hybrid'' audits} \label{sec:hybrid}

Other approaches involve \emph{stratified sampling}: partitioning the cast ballots
into non-overlapping groups and sampling independently from those groups.
One could stratify by county, but in general it is simpler and more efficient
statistically (i.e., results in auditing fewer ballots) to minimize the number of strata.
We consider methods that use two strata: one comprising the ballots cast in CVR counties and the other comprising the ballots cast in
no-CVR counties. 
Every ballot cast in the contest is in 
exactly one of the two strata. 
(Stratification is useful in other circumstances, too, for instance to ``decouple'' sampling
in different counties.
The method we develop here works generally to construct a RLA using stratified sampling.)

Let $V_{w\ell} > 0$ denote the contest-wide margin (in votes) of reported winner 
$w$ over reported loser
$\ell$.
Let $V_{w\ell,s}$ denote the margin (in votes) of reported winner $w$ over reported loser $\ell$
in stratum $s$. 
Note that $V_{w\ell,s}$ could be negative in one stratum.
Let $A_{w\ell}$ denote the margin (in votes)
of reported winner $w$ over reported loser $\ell$ that 
a full hand count of the entire contest would show, that is, the \emph{actual} margin rather
than the \emph{reported} margin.
Reported winner $w$ really beat reported loser $\ell$ if and only if $A_{w\ell} > 0$.
Define $A_{w\ell,s}$ to be the actual margin (in votes) of $w$ over $\ell$ in stratum $s$;
this too may be negative.

Let $\omega_{w\ell,s} \equiv V_{w\ell,s} - A_{w\ell,s}$ be the \emph{overstatement}
of the margin of $w$ over $\ell$ in stratum $s$.
Reported winner $w$ really beat reported loser 
$\ell$ if and only if $\omega_{w\ell} \equiv \omega_{w\ell,1} + \omega_{w\ell,2} < V_{w\ell}$.

The null hypothesis $\omega_{w\ell, 1} + \omega_{w\ell, 2} \ge V_{w\ell}$ is true if and only if there exists \textit{some} pair $\lambda_1 \in \Re$ and $\lambda_2 = 1-\lambda_1$ such that $\omega_{w\ell, s}\ge \lambda_s V_{w\ell}, s=1, 2$.\footnote{
Set $\lambda_1 = \frac{\omega_{w\ell, 1}}{\omega_{w\ell, 1}+\omega_{w\ell, 2}}$ and $\lambda_2 = 1-\lambda_1$.
}
If, for all $(\lambda_1, \lambda_2)$ pairs, we can reject the hypothesis that the 
overstatement error in stratum~1 is greater than or equal to $\lambda_1 V_{w\ell}$ \emph{and} 
the overstatement error in stratum~2 is greater than or equal to $\lambda_2 V_{w\ell}$, then
we can conclude that the outcome is correct.

To test the conjunction hypothesis that both stratum null hypotheses are true, we use 
Fisher's combining function.
Let $p_s(\lambda_s)$ be the $P$-value of the hypothesis $\omega_{w\ell,s} \ge \lambda_s V_{w\ell}$.
If the null hypothesis that $\omega_{w\ell,1} \ge \lambda_1 V_{w\ell}$ and 
$\omega_{w\ell,2} \ge \lambda_2 V_{w\ell}$ is true, then the combination
\beq
   \chi(\lambda_1, \lambda_2) = -2 \sum_{s=1}^2 \ln p_s(\lambda_s)
\eeq
has a probability distribution that is dominated by the chi-square distribution with 4~degrees
of freedom.\footnote{%
   If the two tests had continuously distributed $P$-values, the distribution would be exactly
   chi-square with four degrees of freedom, but if either $P$-value has atoms when
   the null hypothesis is true, it is in general stochastically smaller.
   This follows from a coupling argument along the lines of Theorem~4.12.3 in \cite{grimmett01}.
}
Fisher's combined statistic will tend to be small when both null hypotheses are true.
If either is false, then as the sample size increases, Fisher's combined statistic will tend to grow.

If, for all $\lambda_1$ and $\lambda_2 = 1- \lambda_1$, we can reject the conjunction
hypothesis at level $\alpha$, the audit can stop.
The stratified audit thus involves examining more randomly selected ballots from the two strata until 
either the minimum value Fisher's combined statistic over all pairs $(\lambda_1, \lambda_2)$ is larger than the $1-\alpha$ quantile of the chi-square
distribution with 4 degrees of freedom, or until both strata have been fully hand tabulated.

For Colorado's audits, $p_s(\lambda)$ can be calculated using the methods in 
sections~\ref{sec:comparisonError} and~\ref{sec:ballotPollError}.
Finding $p_s$ using ballot polling requires modifying standard ballot-polling calculations,
because the standard method considers only the fraction of ballots with a vote for either 
$w$ or $\ell$ that contain a vote for $w$, while we need to make an inference about the 
difference between the \emph{number} of votes for $w$ and the number of votes for $\ell$.
This introduces an additional unknown nuisance parameter, the number of ballots with votes for either
$w$ or $\ell$.

In general, $p_s(\lambda)$ could be a $P$-value for the hypothesis
$\omega_{w\ell,s} \ge \lambda_s V_{w\ell}$ from any test procedure (although
if the audit is to be sequential, the tests in the two strata must be sequential tests). 

\subsection{Maximizing Fisher's combined $P$-value}

It is impossible to actually test all combinations of $\lambda_1$ and $\lambda_2$.
Instead, we offer several computational approaches to check whether the conjunction hypothesis can be rejected at level $\alpha$ for all $\lambda_1, \lambda_2$.

The first method is to use an optimization package to maximize the 
Fisher combined $P$-value, or equivalently,
minimize Fisher's combination function.
In simulations, this approach was computationally inefficient and numerically unstable.

A second, crude approach is to search for the maximum Fisher combined $P$-value along a grid of $(\lambda_1, \lambda_2)$ values.
After a maximum is found, the search can be refined by creating a finer grid around the maximizer and repeating the search.
This is what our software does;
 the result is only an approximate maximum. 

The third approach is to compute Fisher's combining function on a grid of possible parameter values and use these points to construct a lower bound on the Fisher's combination function.
If the lower bound is above the upper $\alpha$ quantile of the chi-squared distribution with 4~degrees of freedom,
then we can reject the conjunction hypothesis for all $\lambda_1$ and $\lambda_2$.

We construct a piecewise constant lower bound.
We will reparameterize $(\lambda_1, \lambda_2)$ and write $(\lambda, 1-\lambda)$ instead.
Let $\{\lambda_0, \lambda_1, \dots, \lambda_n\}$ be values of the parameter at which we evaluate $p_1(\lambda)$ and $p_2(1-\lambda)$.
Decompose $-2 = \nu^- - \nu^+$, where $\nu^-, \nu^+ \ge 0$.
Then we can write

\beq
   \chi(\lambda) = -2\ln p_1(\lambda)-2\ln p_2(1-\lambda) = (\nu^- - \nu^+)\left(\ln p_1(\lambda) + \ln p_2(1-\lambda)\right)
\eeq

We use the fact that $p_1(\lambda)$ is monotonically increasing and $p_2(1-\lambda)$ is monotonically decreasing to find a constant lower bound on the interval $[\lambda_i, \lambda_{i+1})$: \textbf{\textcolor{red}{{I think these are the only conditions needed.}}}

\begin{align*}
 \chi(\lambda) &= \nu^- \left(\ln p_1(\lambda) + \ln p_2(1-\lambda)\right) - \nu^+\left(\ln p_1(\lambda) + \ln p_2(1-\lambda)\right) \\
 &\ge \nu^-   \left(\inf_{\xi \in [\lambda_i, \lambda_{i+1})}  \ln p_1(\xi) + \inf_{\xi \in [\lambda_i, \lambda_{i+1})} \ln p_2(1-\xi)\right) - \\
 &  \nu^+ \left(\sup_{\xi \in [\lambda_i, \lambda_{i+1})} \ln p_1(\xi) + \sup_{\xi \in [\lambda_i, \lambda_{i+1})} \ln p_2(1-\xi)\right) \\
 &= \nu^-   \left( \ln p_1(\lambda_i) + \ln p_2(1-\lambda_{i+1})\right) - \nu^+ \left( \ln p_1(\lambda_{i+1}) + \ln p_2(1-\lambda_i)\right) \\
\end{align*}

Letting $\nu^- = 0$ and $\nu^+ = -2$ simplifies the upper bound:

\beq
   \chi(\lambda) \ge -2 \ln p_1(\lambda_{i+1}) -2 \ln p_2(1-\lambda_i)
\eeq
  

%\input{subcollections}
\input{comparisonError}
\input{ballotPollError}

\section{Recommendations} \label{sec:recommendations}

We have outlined several methods Colorado might use to audit cross-jurisdictional contests
that include CVR counties and no-CVR counties.
Stratified ``hybrid'' audits seem the most palatable,
given the constraints on time for software development and the logistics
of the audit itself, because the workflow for counties would be the same
as it was in November, 2017.
Simulations lead us to expect that this approach will be relatively efficient.

What needs to change is the risk calculation, including the
algorithms that determine when the audit can stop.
Those algorithms could be implemented in software external to RLATool.
The minimal modification to RLATool required to conduct
a hybrid audit is to allow the sample size from each county to be controlled externally,
\emph{e.g.}, by providing a parameter file for each round,
rather than using the current formula built into RLATool, 
which is based on the margin within each county alone.
The parameter file could be generated by external software that does the
audit calculations described here based on the detailed
audit progress using data exported via the RLATool \texttt{rla\_export} command.


\subsection{Software and examples}
Examples of stratified hybrid audits are in Jupyter notebooks available
at \url{https://www.github.com/pbstark/CORLA18}.
The first two examples are contained in a single notebook, \texttt{hybrid-audit-example-1}.

The first example is a hypothetical medium-sized election with 
$110,000$ ballots cast and a diluted margin of $1.8\%$, of which 
9.1\% were cast in no-CVR counties. 
In 93 of 100 simulations, a stratified ``hybrid'' audit at risk limit 10\% with sample sizes of 400 ballots 
in the CVR stratum and 600 ballots in the no-CVR stratum
(1,000 ballots in all)
would have sufficed to confirm that the total overstatement error did not exceed the overall margin.

If all counties were CVR counties, making it possible to conduct a ballot-level comparison audit for the entire contest, an unstratified audit with risk limit 10\% that found no errors terminate 
after examining 263 ballots.
In contrast, a ballot-polling audit of the entire contest would have been expected to examine
13,988 ballots, more than 10\% of ballots cast.
That is so large that it would probably be more efficient simply to conduct a full hand count.
The hybrid audit is not as efficient as a ballot-level comparison audit would have been, but the penalty
is not nearly as large as giving up the CVRs in CVR counties.

For the maximum Fisher's combined $P$-value to be less than the risk limit,
it suffices for the $P$-value in one stratum to be sufficiently small, even if 
the $P$-value in the other is large. 
For instance, if the stratum $P$-value in one stratum is $2\%$,
then even if the other stratum $P$-value is as high as $90\%$
the Fisher's combined $P$-value is less than $10\%$.
However if one stratum $P$-value is just slightly higher at $5\%$,
then even moderate $P$-values in the other stratum would push 
the Fisher's combined $P$-value above $10\%$.

Another conservative method, discussed in Section~\ref{sec:two-vote-over},
involves conducting a ballot-level comparison audit statewide,
treating any ballot selected from the no-CVR county as if it had a two-vote overstatement.
In this numerical example, that method would lead to a full hand count.

The second numerical example is a hypothetical large statewide election with a total of 
2~million ballots cast and a diluted margin of nearly $20\%$.  
The risk limit is 5\%.
\comment{How many ballots in each stratum?}
If it were possible to conduct a ballot-level comparison audit for the entire contest, 
an audit at risk limit 5\% could terminate after examining 31~ballots if it found no errors.

The workload for a hybrid stratified audit is not substantially higher:
In 98\% of 10,000 simulations, an audit with samples of 43 ballots in the 
CVR stratum and 20 ballots in the no-CVR stratum
would have sufficed to confirm the outcome at a 5\% risk limit.

A second notebook, \texttt{hybrid-audit-example-2}, illustrates the workflow for conducting a hybrid 
stratified audit.
The example election has a total of 2~million ballots.
The reported margin is just over $1\%$, but in reality the vote totals for the reported winner
and reported loser are identical in both strata.  The risk limit is 5\%.
We use Fisher's method to combine the audits in the CVR stratum and no-CVR stratum.
The sample sizes in each stratum are large, but the maximum Fisher's combined $P$-value is over 20\%,
so the audit cannot be terminated.
In each case, the audit leads to a full recount of all the ballots.

These notebooks can be modified and run with different contest sizes, margins, and risk limits, in order to
estimate the workload of different scenarios.

\bibliography{./pbsBib}

\end{document}
